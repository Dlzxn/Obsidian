source:  [[Математика/дискретная математика/Дискретная математика|Дискретная математика]]
tegs: #math 
### **Формула включений и исключений**

Формула включений и исключений позволяет вычислить мощность объединения нескольких множеств, учитывая их пересечения. Для конечных множеств $A_1, A_2, \dots, A_n$ мощность их объединения определяется как: $$|A_1 \cup A_2 \cup \dots \cup A_n| = \sum_{k=1}^n (-1)^{k+1} \sum_{1 \leq i_1 < i_2 < \dots < i_k \leq n} |A_{i_1} \cap A_{i_2} \cap \dots \cap A_{i_k}|$$
Пример: $$\begin{align}|A \cup B \cup C\cup D|=|A|+|B|+|C|+|D|\\
-|A\cap B|-|A\cap C|-|A\cap D|-|B\cap C|-|B\cap D|-|C\cap D|\\
+|A\cap B\cap C|+|A\cap B\cap D|+|A\cap C\cap D|+|B\cap C\cap D| \\
-|A\cap B\cap C\cap D|\end{align}$$

---

### **Альтернативная формулировка на языке объектов и их свойств**

Рассмотрим множество объектов $X$, и пусть каждому объекту $x \in X$ соответствует набор свойств $P_1, P_2, \dots, P_n$. Обозначим $A_i$ как множество объектов, обладающих свойством $P_i$, то есть $A_i = {x \in X : P_i(x) \text{ истинно}}$. Тогда мощность объединения множеств $A_1, A_2, \dots, A_n$, то есть количество объектов, обладающих хотя бы одним из свойств $P_1, P_2, \dots, P_n$, определяется формулой включений и исключений. $$|A_1 \cup A_2 \cup \dots \cup A_n| = \sum_{k=1}^n (-1)^{k+1} \sum_{1 \leq i_1 < i_2 < \dots < i_k \leq n} |A_{i_1} \cap A_{i_2} \cap \dots \cap A_{i_k}|$$

---

### **Задача о беспорядках**

Задача о беспорядках заключается в подсчёте количества полных перестановок множества из $n$ элементов, таких что ни один элемент не стоит на своём месте. Это количество обозначается как $D_n$ и называется числом беспорядков.

#### **Решение задачи с помощью формулы включений и исключений**

Обозначим множество перестановок элементов ${1, 2, \dots, n}$ как $S_n$. Пусть $A_i$ — множество перестановок, в которых элемент $i$ стоит на своём месте. Тогда: $$A_i = \{\sigma \in S_n : \sigma(i) = i\}$$Мощность объединения всех $A_i$, то есть перестановок, в которых хотя бы один элемент стоит на своём месте, равна: $$|A_1 \cup A_2 \cup \dots \cup A_n| = \sum_{k=1}^n (-1)^{k+1} \sum_{1 \leq i_1 < i_2 < \dots < i_k \leq n} |A_{i_1} \cap A_{i_2} \cap \dots \cap A_{i_k}|$$
1. Если $k$ элементов фиксированы на своих местах, то оставшиеся $n - k$ элементы могут быть переставлены любым образом, то есть $|A_{i_1} \cap \dots \cap A_{i_k}| = (n-k)!$.
2. Таким образом, мощность объединения равна: $$|A_1 \cup A_2 \cup \dots \cup A_n| = \sum_{k=1}^n (-1)^{k+1} \binom{n}{k} (n-k)!$$Напоминаю: $\binom{n}{k}=C_{n}^k$

Количество беспорядков $D_n$ определяется как: $$D_n = n! - |A_1 \cup A_2 \cup \dots \cup A_n| = n! \sum_{k=0}^n \frac{(-1)^k}{k!}$$
#### **Рекуррентная формула**

Число беспорядков $D_n$ также удовлетворяет рекуррентной формуле: $$D_n = n D_{n-1} + (-1)^n$$где $D_0 = 1$ и $D_1 = 0$.

---

### **Пример: Найти $D_3$**

1. Общее число перестановок: $3! = 6$.
2. Рассчитаем с помощью формулы включений и исключений: $$D_3 = 3! \sum_{k=0}^3 \frac{(-1)^k}{k!} = 6 \left(1 - \frac{1}{1!} + \frac{1}{2!} - \frac{1}{3!}\right) = 6 \left( 1 - 1 + \frac{1}{2} - \frac{1}{6}\right) = 6 \cdot \frac{1}{3} = 2$$
Ответ: $D_3 = 2$.